<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<div class="row">
  <div class="col-xs-3 col-sm-3">
    <h1>StockStacker</h1>
  </div>

  <div class="col-xs-9 col-sm-9">
  <br />
    <div class="pull-right">
      <% link_to "Profile Search", profiles_path, class: 'btn btn-default btn-lg btn-warning', "data-no-turbolink"=>"true" %>
    </div>
  </div>
</div>

<ul id="orders">
  <li>name, drink</li>
</ul>

<h4>add a order</h4>
<p>Name: <input type="text" id="name"></p>
<p>Drink: <input type="text" id="last_id"></p>
<button id="add-order">Add!</button>




<!--
 form_for(phase) do |f| %>


<hidden="true">
 f.submit "Send", :class=> "btn btn-info btn-sm" %>
button_to "Acknowledged", { :controller => 'messgs', :action => "sendcustom", :id => @messg.id}


 f.submit(:class=> "btn btn-info btn-lg", :id => "hiddensubmit#{phase.id}", :style => "visibility:hidden") %>
 end %>

-->















<!--<html>
  <head>-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(load_page_data);

      function load_page_data(){

        var $prices = $('#orders');
        var $name = $('#name');
        var $last_id = $('#last_id');
        var $chart_array = [['day', 1, 25, 50, 100]];

        var $startingcounter = 0;

        $.ajax({
          type: 'GET',
          url: '/orders',
          success: function(prices) {
            $.each(prices, function(i, price) {
              if(price) {
                $chart_array.push(['day', price.low, price.close, price.open, price.high]);
                drawChart($chart_array);
              }
              $('#last_id').val(price.id);
              $('#name').val(price.ticker);
              //if ($startingcounter > 24)
                //return false;
            });
          },
          error: function() {
            alert('error loading prices')
          }
        });


        $('#add-order').on('click',function(){
          var order = {
            name: $name.val(),
            id: $last_id.val(),
          };
          $.ajax({
            type: 'POST',
            url: '/orders',
            data: order,//order,
            success: function(prices) {
              if(prices) {
                //oldchart = $chart_array;
                $chart_array.push(['day', prices.low, prices.close, prices.open, prices.high]);
                //chart_data = ([oldchart, $chart_array]);
                //alert(chart_data);
                drawChart($chart_array);
              }
              //$prices.append('<li>Name: ' + prices.ticker + '</li>');
              $('#last_id').val(prices.id);
              $('#name').val(prices.ticker);
            },
            error: function() {
              alert('error saving order' + order.id);
            }
          });
        });
      }




      function drawChart(chart_data) {
        var data = google.visualization.arrayToDataTable(chart_data, true);
          //[
          //[ days[2], lows[2], closes[2], opens[2], highs[2]],
          //['Thu', 50, 76, 66, 77],
          //['Fri', 62, 66, 76, 80]
          // Treat first row as data as well.
        //], true);

        var options = {
          legend:'none'
        };

        var chart = new google.visualization.CandlestickChart(document.getElementById('chart_div'));

        chart.draw(data, options);
      }
  </script>
<!--  </head>
  <body>-->
    <div id="chart_div" style="width: 900px; height: 500px;"></div>
    <div class="btn btn-default btn-lg btn-primary">
    <%=  label "", "Short", {"onclick"=>"clickbuy()"} %></div>


<!--  </body>
</html>
-->

<% if current_user.profile.title == "admin" || current_user.profile.title == "master" %>
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <%= link_to "Prices", prices_path, class: 'btn btn-default btn-lg', "data-no-turbolink"=>"true" %>
<% end %>
